<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Bootstrap Form with Select2 Multiselect</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">

    <!-- Bootstrap Toggle CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://kit.fontawesome.com/4786baebda.js" crossorigin="anonymous"></script>
    <!-- Custom CSS for secondary button color -->
    <style>
        .btn-secondary {
            color: #fff;
            background-color: #6c757d;
            border-color: #6c757d;
        }

    </style>
</head>
<body>

<!--navbar-->
<nav class="navbar navbar-expand-md navbar-dark bg-secondary">
    <div class="container-xxl">
        <a href="#intro" class="navbar-brand">
            <span class="fw-bold text-secondary text-light ms-4">
                Product Modeling
            </span>
        </a>
        <!--Toggle button for nav on mobile devices-->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false"
        aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!--navbar links-->
        <div class="collapse navbar-collapse justify-content-end align-center"
        id="main-nav">
        <ul class="navbar-nav nav-underline">
            <li class="nav-item">
                <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="help.html">Help</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="home.html">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="contact.html">Contact</a>
            </li>

        </ul>

        </div>
    </div>
</nav>    

<!--Form Section -->
<div class="container mt-5">
    <!-- Combined Form -->
    <form id="combinedForm" method="post">
        <!-- Form 1 -->
        <div id="form1" class="form-group">
            <label for="multiSelect">Select products to be modeled:</label>
            <span class="question-mark-icon" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true"  title="<br>Tier 1: 0 to 3Wp Eg;Lanterns  </br> <br>Tier 2: 3 to 10Wp Eg;Multi-light systems</br> <br>Tier 3: 11 to 50Wp Eg;Basic Solar Home Systems</br> <br>Tier 4: over 50Wp Eg;Higher Capacity SHS</br>">
                <i class="fa-solid fa-circle-question" style="color: #191937;"></i>
            </span>

            <select id="multiSelect"  class="form-control" multiple="multiple">
                <option value="T1">Tier 1</option>
                <option value="T2">Tier 2</option>
                <option value="T3">Tier 3</option>
                <option value="T4">Tier 4</option>
                <option value="T4">Lead Acid Battery</option>
                <option value="T4">Lithium Ion Battery</option>
                <option value="T4">Mini-Grids</option>
                <option value="T4">Lead Acid Battery -Minigrid</option>
                <option value="T4">Lithium Ion Battery -Minigrid</option>
            </select>
            <div><br>
            <button type="button" class="btn btn-secondary" onclick="showForm(2)">Next</button>
            </div>

        </div>



        <!-- Form 2 -->
        <div id="form2" class="form-group" style="display: none;">
            <label for="startingYear">What is the starting year for placing products on the market?</label>
            <input type="text" name="startingYear" class="form-control" id="startingYear" placeholder="Enter starting year">
            <div><br>
        <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="showForm(1)">Previous</button>
            <button type="button" class="btn btn-secondary" onclick="showForm(3)">Next</button>
            </div>
       
        </div>



        <!-- Form 3 -->
        <div id="form3" class="form-group" style="display: none;">
            <label for="numberOfYears">For how many years are products placed on the market?</label>
            <input type="text" name="numberOfYears" class="form-control" id="numberOfYears" placeholder="Enter number of years">
            <div><br>
            <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="showForm(2)">Previous</button>
            <button type="button" class="btn btn-secondary" onclick="generateMatrixTable()">Next</button>
            </div>
        
        </div>

        <!-- Matrix Table (Initially Hidden) -->
        <div id="matrixTable" style="display: none;">
            <!-- ... (unchanged matrix table code) ... -->

            <h3>Enter the units or quantity of products placed on market in each year</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <!-- Headers based on form 2 input -->
                        <!-- Will be dynamically generated by JavaScript -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows based on form 1 input -->
                    <!-- Will be dynamically generated by JavaScript -->
                </tbody>
            </table>

            <div><br>
            <!-- Next Button (to Form 5) -->
            <button type="button" class="btn btn-secondary" onclick="showForm(5)">Next</button>
            </div>
        
        
        </div>

        <!-- Form 5 -->
        <div id="form5" class="form-group" style="display: none;">
            <label for="defaultValuesToggle">Use default values of weight and lifespan?</label>
            <span class="question-mark-icon" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true"  title="<br>T1: weight: 0.5kg, lifespan: 3.3 years</br> <br>T2: weight: 4kg, lifespan: 3.7 years</br> <br>T3: weight: 5kg, lifespan: 8.5 years</br> <br> T4: weight: 7kg, lifespan: 8.5 years</br> <br>Lead Acid Battery: weight: 3kg, lifespan: 2.7 years</br> <br>Lithium Ion Batteries: weight: 1kg, lifespan: 3.7 years</br> <br>Minigrid: weight: 8000kg, lifespan: 25.7 years</br>">
                <i class="fa-solid fa-circle-question" style="color: #191937;"></i>
            </span>
            <div class="form-check form-switch">
                <input class="form-check-input" name="defaultValuesToggle" type="checkbox" id="defaultValuesToggle" checked>
                <label class="form-check-label" for="defaultValuesToggle">Yes/No</label>
            </div>
            
            <div><br>
             <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="skipToForm7()">Next</button>
            </div>
        </div>

        <!-- Form 6 (Matrix Input, Initially Hidden) -->
        <div id="form6" style="display: none;">
            <!-- ... (unchanged form 6 code) ... -->

            <h3>Enter custom values for product weight and average lifespan</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Weight</th>
                        <th>Lifespan in years</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows based on form 1 input -->
                    <!-- Will be dynamically generated by JavaScript -->
                </tbody>
            </table>

            <div><br>
             <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="showForm(5)">Previous</button>
            <button type="button" class="btn btn-secondary" onclick="showForm(7)">Next</button>                
            </div>
        
        </div>


        <!-- Form 7 -->
        <div id="form7" class="form-group" style="display: none;">
            <label for="wasteTreatmentToggle">Use default cost values for Waste Treatment?</label>
            <span class="question-mark-icon" data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true"  title="<br>Metals: 781 USD</br> <br>Plastic: 781 USD</br> <br>Cables: 635 USD</br> <br> Control Units: 1,054 USD</br> <br>Panels: 1,054 USD</br> <br>Mixed Solar: 974 USD</br> <br>Lithium Batteries: 1,237 USD</br>">
                <i class="fa-solid fa-circle-question" style="color: #191937;"></i>
            </span>
            <div class="form-check form-switch">
                <input class="form-check-input" name="wasteTreatmentToggle" type="checkbox" id="wasteTreatmentToggle" checked>
                <label class="form-check-label" for="wasteTreatmentToggle">Yes/No</label>
            </div>

            <div><br>
            <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="showForm(7)">Previous</button>
            <button type="button" class="btn btn-secondary" onclick="skipToForm9()">Next</button>
            </div>

        </div>

        <!-- Form 8 -->
        <div id="form8" style="display: none;">
            <!-- ... (unchanged form 8 code) ... -->

            <h3>Enter waste treatment cost for the following waste streams</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Waste stream</th>
                        <th>Average Waste Treatment Cost (USD/ton)</th>
                    </tr>
                </thead>
                <tbody >
                    <tr>
                        <td>Metals</td>
                        <td><input type="text" name="metalsInput" class="form-control" id="metalsInput" placeholder="Enter value for Metals"></td>
                    </tr>
                    <tr >
                        <td>Plastic</td>
                        <td><input type="text" name="plasticInput" class="form-control" id="plasticInput" placeholder="Enter value for Plastic"></td>
                    </tr>
                    <tr>
                        <td>Cables</td>
                        <td><input type="text" name="cablesInput" class="form-control" id="cablesInput" placeholder="Enter value for Cables"></td>
                    </tr>
                    <tr>
                        <td>Control Units</td>
                        <td><input type="text" name="controlUnitsInput" class="form-control" id="controlUnitsInput" placeholder="Enter value for Control Units"></td>
                    </tr>
                    <tr>
                        <td>Panels</td>
                        <td><input type="text" name="panelsInput" class="form-control" id="panelsInput" placeholder="Enter value for Panels"></td>
                    </tr>
                    <tr>
                        <td>Mixed Solar</td>
                        <td><input type="text" name="mixedSolarInput" class="form-control" id="mixedSolarInput" placeholder="Enter value for Mixed Solar"></td>
                    </tr>
                    <tr>
                        <td>Lithium Batteries</td>
                        <td><input type="text" name="lithiumBatteriesInput" class="form-control" id="lithiumBatteriesInput" placeholder="Enter value for Lithium Batteries"></td>
                    </tr>
                </tbody>
            </table>

            <div><br>
            <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="showForm(7)">Previous</button>
            <button type="button" class="btn btn-secondary" onclick="showForm(9)">Next</button>
            </div>

        </div>

        <!-- Form 9 -->
        <div id="form9" class="form-group" style="display: none;">
            <label for="batteryPercentage">For Tiers 1 to 4 products, what is the percentage share of products using lead acid batteries compared to other battery chemistries?</label>
            <input type="text" name="batteryPercentage" class="form-control" id="batteryPercentage" placeholder="Enter percentage">
        
            <div><br>
            <!-- Navigation Buttons -->
            <button type="button" class="btn btn-secondary" onclick="showForm(8)">Previous</button>
            <button type="button" class="btn btn-secondary" onclick="submitForm()" >Submit</button>
            </div>
        
        </div>

    </form>

    <!-- jQuery and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <!-- Bootstrap Toggle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap5-toggle@5.0.6/js/bootstrap5-toggle.jquery.min.js"></script>


    <!-- Custom JavaScript -->
    <script>

        var formData = {
            selectedProducts: [],
        };


        $(document).ready(function() {
                $('#multiSelect').select2();
                $('#defaultValuesToggle').bootstrapSwitch();
                //$('[data-bs-toggle="tooltip"]').tooltip();
                //$('[data-bs-toggle="tooltips"]').tooltip();                

            });

            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

        function showForm(formNumber) {
            // Hide all forms and the matrix table
            $('#form1, #form2, #form3, #matrixTable, #form5, #form6, #form7').hide();

            // Show the selected form
            $('#form' + formNumber).show();

            // Special case for Form 6 - Generate input matrix table
            if (formNumber === 6) {
                generateInputMatrixTable();
            }
        }


        function generateMatrixTable() {
                // Get input values from forms
                formData.selectedProducts = $('#multiSelect').val();
                console.log(formData.selectedProducts); 
                var selectedProducts = $('#multiSelect').val();
                var startingYear = $('#startingYear').val();
                var numberOfYears = $('#numberOfYears').val();

                // Validate input
                if (!selectedProducts || !startingYear || !numberOfYears) {
                    alert("Please fill out all fields before generating the matrix table.");
                    return;
                }

                // Show matrix table
                $('#matrixTable').show();

                // Generate headers based on form 2 input
                var tableHeaders = '<th>Product</th>';
                for (var i = 0; i < numberOfYears; i++) {
                    var year = parseInt(startingYear) + i;
                    tableHeaders += '<th>' + year + '</th>';
                }
                $('#matrixTable thead tr').html(tableHeaders);

                // Generate rows based on form 1 input
                var tableRows = '';
                for (var j = 0; j < selectedProducts.length; j++) {
                    tableRows += '<tr><td>' + selectedProducts[j] + '</td>';
                    for (var k = 0; k < numberOfYears; k++) {
                        tableRows += '<td><input type="text" class="form-control"></td>';
                    }
                    tableRows += '</tr>';
                }
                $('#matrixTable tbody').html(tableRows);

                    // Store matrix table data in formData
                formData.matrixTable = [];
                $('#matrixTable tbody tr').each(function () {
                    var row = {};
                    $(this).find('td').each(function (index) {
                        if (index === 0) {
                            row.product = $(this).text();
                        } else {
                            row['year_' + index] = $(this).find('input').val();
                        }
                    });
                    formData.matrixTable.push(row);
                });


            }



            
        function generateInputMatrixTable() {
                // Get selected products from form 1
                formData.selectedProducts = $('#multiSelect').val();

                // Show form 6 (Matrix Input)
                $('#form6').show();

                // Generate rows based on form 1 input
                var inputTableRows = '';
                for (var i = 0; i < formData.selectedProducts.length; i++) {
                    inputTableRows += '<tr>';
                    inputTableRows += '<td>' + formData.selectedProducts[i] + '</td>';
                    inputTableRows += '<td><input type="text" class="form-control" name="weights[]" placeholder="Enter weight"></td>';
                    inputTableRows += '<td><input type="text" class="form-control" name="lifespans[]" placeholder="Enter lifespan"></td>';
                    inputTableRows += '</tr>';
                }
                $('#form6 tbody').html(inputTableRows);

                // Set the matrix input data in formData
                formData.matrixInputData = [];
                $('#form6 tbody tr').each(function(index, row) {
                    var product = $(row).find('td:first-child').text();
                    var weight = $(row).find('td:nth-child(2) input').val();
                    var lifespan = $(row).find('td:nth-child(3) input').val();
                    formData.matrixInputData.push({ product: product, weight: weight, lifespan: lifespan });
                });
            }



        function skipToForm7() {
                // Check if the switch is ON
                var switchState = $('#defaultValuesToggle').prop('checked');

                // If switch is ON, skip to Form 7
                if (switchState) {
                    showForm(7);
                } else {
                    // If switch is OFF, proceed to Form 6
                    showForm(6);
                }
            }

        function skipToForm9() {
                // Check if the switch is ON
                var switchState2 = $('#wasteTreatmentToggle').prop('checked');

                // If switch is ON, skip to Form 10
                if (switchState2) {
                    showForm(9);
                } else {
                    // If switch is OFF, proceed to Form 9
                    showForm(8);
                }

                
                // Add matrix table data to formData
                formData.matrixTable = [];
                $('#matrixTable tbody tr').each(function () {
                    var row = {};
                    $(this).find('td').each(function (index) {
                        if (index === 0) {
                            row.product = $(this).text();
                        } else {
                            row['year_' + index] = $(this).find('input').val();
                        }
                    });
                    formData.matrixTable.push(row);
                });

                formData.selectedProducts = $('#multiSelect').val();

            }


        function submitForm() {
                // Add other form data to formData
                formData.selectedProducts = $('#multiSelect').val();
                formData.startingYear = $('#startingYear').val();
                formData.numberOfYears = $('#numberOfYears').val();
                formData.defaultValuesToggle = $('#defaultValuesToggle').val();
                formData.wasteTreatmentToggle = $('#wasteTreatmentToggle').val();
                formData.metalsInput = $('#metalsInput').val();
                formData.plasticInput = $('#plasticInput').val();
                formData.cablesInput = $('#cablesInput').val();
                formData.controlUnitsInput = $('#controlUnitsInput').val();
                formData.panelsInput = $('#panelsInput').val();
                formData.mixedSolarInput = $('#mixedSolarInput').val();
                formData.lithiumBatteriesInput = $('#lithiumBatteriesInput').val();
                formData.batteryPercentage = $('#batteryPercentage').val();
                // ... (add other form fields as needed)


                // Add matrix input data to formData
                formData.matrixInputData = [];
                $('#form6 tbody tr').each(function(index, row) {
                    var product = $(row).find('td:first-child').text();
                    var weight = $(row).find('td:nth-child(2) input').val();
                    var lifespan = $(row).find('td:nth-child(3) input').val();
                    formData.matrixInputData.push({ product: product, weight: weight, lifespan: lifespan });
                });

                event.preventDefault();


                // Submit formData to your server
                $.ajax({
                    type: 'POST',
                    url: 'http://127.0.0.1:5000/Product_modeling',
                    data: JSON.stringify(formData),
                    contentType: 'application/json',
                    success: function(response) {
                                    // Handle success
                    // Log the response to the console for debugging
                    console.log(response);

                    // Check if the response is defined and has a status property
                    if (response && response.status) {
                        if (response.status === 'success') {
                            // Handle success
                            alert('Form submitted successfully!');
                        } else {
                            // Handle failure
                            alert('Error: ' + response.message);
                        }
                    } else {
                        // Handle unexpected response format
                        alert('Error: Unexpected response format');
                    }
                },


                        

                        //if (response.success) {
                            // Redirect to a new page after successful submission
                            //window.location.href = 'http://127.0.0.1:5000/matrix.html';  // Replace with your desired URL
                        //} else {
                            // Handle any errors if needed
                            //alert('Error: ' + response.message);
                       //}

                    //},
                    //error: function(error) {
                        // Handle error
                        //alert('Error: ' + error.statusText);
                    //}
                });


            }
    </script>
</body>
</html>
