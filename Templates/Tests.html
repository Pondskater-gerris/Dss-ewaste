<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Bootstrap Form with Select2 Multiselect</title>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <!-- Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet">

    <!-- Bootstrap Toggle CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS for secondary button color -->
    <style>
        .btn-secondary {
            color: #fff;
            background-color: #6c757d;
            border-color: #6c757d;
        }
    </style>
</head>
<body>

 <!--navbar-->
 <nav class="navbar navbar-expand-md navbar-dark bg-secondary">
    <div class="container-xxl">
        <a href="#intro" class="navbar-brand">
            <span class="fw-bold text-secondary text-light ms-4">
                Product Modeling
            </span>
        </a>
        <!--Toggle button for nav on mobile devices-->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
        data-bs-target="#main-nav" aria-controls="main-nav" aria-expanded="false"
        aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!--navbar links-->
        <div class="collapse navbar-collapse justify-content-end align-center"
        id="main-nav">
        <ul class="navbar-nav nav-underline">
            <li class="nav-item">
                <a class="nav-link" href="#thetool">About</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#help">Help</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#home">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#contact">Contact</a>
            </li>

        </ul>

        </div>
    </div>
</nav>    


<!--Form Section -->
<div class="container mt-5">
    <!-- Form 1 -->
    <form id="form1" action="#" method="post">
        <div class="form-group">
            <label for="multiSelect">Select Options:</label>
            <select id="multiSelect" class="form-control" multiple="multiple">
                <option value="T1">Tier 1</option>
                <option value="T2">Tier 2</option>
                <option value="T3">Tier 3</option>
                <option value="T4">Tier 4</option>
                <option value="T4">Lead Acid Battery</option>
                <option value="T4">Lithium Ion Battery</option>
                <option value="T4">Mini-Grids</option>
                <option value="T4">Lead Acid Battery -Minigrid</option>
                <option value="T4">Lithium Ion Battery -Minigrid</option>
            </select>
        </div>

        <!-- Next Button (to Form 2) -->
        <button type="button" class="btn btn-secondary" onclick="showForm(2)">Next</button>
    </form>

    <!-- Form 2 (Initially Hidden) -->
    <form id="form2"   action="#" method="post" style="display: none;">
        <div class="form-group">
            <label for="startingYear">What is the starting year for POM?</label>
            <input type="text" class="form-control" id="startingYear" placeholder="Enter starting year">
        </div>

        <!-- Navigation Buttons -->
        <button type="button" class="btn btn-secondary" onclick="showForm(1)">Previous</button>
        <button type="button" class="btn btn-secondary" onclick="showForm(3)">Next</button>
    </form>

    <!-- Form 3 (Initially Hidden) -->
    <form id="form3" action="#" method="post" style="display: none;">
        <div class="form-group">
            <label for="numberOfYears">How many years POM?</label>
            <input type="text" class="form-control" id="numberOfYears" placeholder="Enter number of years">
        </div>

        <!-- Navigation Buttons -->
        <button type="button" class="btn btn-secondary" onclick="showForm(2)">Previous</button>
        <button type="button" class="btn btn-secondary" onclick="generateMatrixTable()">Next</button>
    </form>

    <!-- Matrix Table (Initially Hidden) -->
    <div id="matrixTable" style="display: none;">
        <h3>Matrix Table</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Product</th>
                    <!-- Headers based on form 2 input -->
                    <!-- Will be dynamically generated by JavaScript -->
                </tr>
            </thead>
            <tbody>
                <!-- Rows based on form 1 input -->
                <!-- Will be dynamically generated by JavaScript -->
            </tbody>
        </table>

        <!-- Next Button (to Form 5) -->
        <button type="button" class="btn btn-secondary" onclick="showForm(5)">Next</button>
    </div>

    <!-- Form 5 (Initially Hidden) -->
    <form id="form5" action="#" method="post" style="display: none;">
        <div class="form-group">
            <label for="defaultValuesToggle">Use default values of weight and lifespan?</label>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="defaultValuesToggle" checked>
                <label class="form-check-label" for="defaultValuesToggle">Yes/No</label>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <button type="button" class="btn btn-secondary" onclick="skipToForm7()">Next</button>
    </form>

    <!-- Form 6 (Matrix Input, Initially Hidden) -->
    <form id="form6" action="#" method="post" style="display: none;">
        <h3>Matrix Input Table</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Weight</th>
                    <th>Lifespan</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows based on form 1 input -->
                <!-- Will be dynamically generated by JavaScript -->
            </tbody>
        </table>

        <!-- Navigation Buttons -->
        <button type="button" class="btn btn-secondary" onclick="showForm(5)">Previous</button>
        <button type="button" class="btn btn-secondary" onclick="showForm(7)">Next</button>
    </form>

    <!-- Form 7 (Initially Hidden) -->
    <form id="form7" action="#" method="post" style="display: none;">
        <div class="form-group">
            <label for="batteryPercentage">What percentage of your batteries are lead acid?</label>
            <input type="text" class="form-control" id="batteryPercentage" placeholder="Enter percentage">
        </div>

        <!-- Navigation Buttons -->
        <button type="button" class="btn btn-secondary" onclick="showForm(6)">Previous</button>
        <button type="button" class="btn btn-secondary" onclick="showForm(8)">Next</button>
    </form>

    <!-- Form 8 (Initially Hidden) -->
    <form id="form8" action="#" method="post" style="display: none;">
        <div class="form-group">
            <label for="wasteTreatmentToggle">Use default cost values for Waste Treatment?</label>
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="wasteTreatmentToggle" checked>
                <label class="form-check-label" for="wasteTreatmentToggle">Yes/No</label>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <button type="button" class="btn btn-secondary" onclick="showForm(7)">Previous</button>
        <button type="button" class="btn btn-secondary" onclick="skipToForm10()">Next</button>
    </form>

    <!-- Form 9 (Initially Hidden) -->
<form id="form9"  action="#" method="post" style="display: none;">
    <h3>List and User Input</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Item</th>
                <th>User Input</th>
            </tr>
        </thead>
        <tbody >
            <tr>
                <td>Metals</td>
                <td><input type="text" class="form-control" id="metalsInput" placeholder="Enter value for Metals"></td>
            </tr>
            <tr >
                <td>Plastic</td>
                <td><input type="text" class="form-control" id="plasticInput" placeholder="Enter value for Plastic"></td>
            </tr>
            <tr>
                <td>Cables</td>
                <td><input type="text" class="form-control" id="cablesInput" placeholder="Enter value for Cables"></td>
            </tr>
            <tr>
                <td>Control Units</td>
                <td><input type="text" class="form-control" id="controlUnitsInput" placeholder="Enter value for Control Units"></td>
            </tr>
            <tr>
                <td>Panels</td>
                <td><input type="text" class="form-control" id="panelsInput" placeholder="Enter value for Panels"></td>
            </tr>
            <tr>
                <td>Mixed Solar</td>
                <td><input type="text" class="form-control" id="mixedSolarInput" placeholder="Enter value for Mixed Solar"></td>
            </tr>
            <tr>
                <td>Lithium Batteries</td>
                <td><input type="text" class="form-control" id="lithiumBatteriesInput" placeholder="Enter value for Lithium Batteries"></td>
            </tr>
        </tbody>
    </table>

    <!-- Navigation Buttons -->
    <button type="button" class="btn btn-secondary" onclick="showForm(8)">Previous</button>
    <button type="button" class="btn btn-secondary" onclick="showForm10()">Next</button>
</form>

    <!-- Form 10 (Initially Hidden) -->
    <form id="form10" action="#" method="post" style="display: none;">
        <div class="form-group">
            <label for="toresults">Drum Roll</label>
        </div>

        <!-- Navigation Buttons -->
        <button type="submit" class="btn btn-secondary" onclick="submitForm()">Show Results</button>
    </form>


</div>

<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- Select2 JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

<!-- Bootstrap Toggle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Custom JavaScript -->
<script>
    $(document).ready(function() {
        $('#multiSelect').select2();
        $('#defaultValuesToggle').bootstrapToggle();
    });

    function showForm(formNumber) {
        // Hide all forms and the matrix table
        $('#form1, #form2, #form3, #matrixTable, #form5, #form6, #form7, #form8').hide();

        // Show the selected form
        $('#form' + formNumber).show();

        // Special case for Form 6 - Generate input matrix table
        if (formNumber === 6) {
            generateInputMatrixTable();
        }
    }

    function generateMatrixTable() {
        // Get input values from forms
        var selectedProducts = $('#multiSelect').val();
        var startingYear = $('#startingYear').val();
        var numberOfYears = $('#numberOfYears').val();

        // Validate input
        if (!selectedProducts || !startingYear || !numberOfYears) {
            alert("Please fill out all fields before generating the matrix table.");
            return;
        }

        // Show matrix table
        $('#matrixTable').show();

        // Generate headers based on form 2 input
        var tableHeaders = '<th>Product</th>';
        for (var i = 0; i < numberOfYears; i++) {
            var year = parseInt(startingYear) + i;
            tableHeaders += '<th>' + year + '</th>';
        }
        $('#matrixTable thead tr').html(tableHeaders);

        // Generate rows based on form 1 input
        var tableRows = '';
        for (var j = 0; j < selectedProducts.length; j++) {
            tableRows += '<tr><td>' + selectedProducts[j] + '</td>';
            for (var k = 0; k < numberOfYears; k++) {
                tableRows += '<td><input type="text" class="form-control"></td>';
            }
            tableRows += '</tr>';
        }
        $('#matrixTable tbody').html(tableRows);
    }

    function generateInputMatrixTable() {
        // Get selected products from form 1
        var selectedProducts = $('#multiSelect').val();

        // Show form 6 (Matrix Input)
        $('#form6').show();

        // Generate rows based on form 1 input
        var inputTableRows = '';
        for (var i = 0; i < selectedProducts.length; i++) {
            inputTableRows += '<tr>';
            inputTableRows += '<td>' + selectedProducts[i] + '</td>';
            inputTableRows += '<td><input type="text" class="form-control" name="weights[]" placeholder="Enter weight"></td>';
            inputTableRows += '<td><input type="text" class="form-control" name="lifespans[]" placeholder="Enter lifespan"></td>';
            inputTableRows += '</tr>';
        }
        $('#form6 tbody').html(inputTableRows);
    }

    function skipToForm7() {
        // Check if the switch is ON
        var switchState = $('#defaultValuesToggle').prop('checked');

        // If switch is ON, skip to Form 7
        if (switchState) {
            showForm(7);
        } else {
            // If switch is OFF, proceed to Form 6
            showForm(6);
        }
    }

    // Function to show Form 8
    function showForm8() {
        // Hide all forms and the matrix table
        $('#form1, #form2, #form3, #matrixTable, #form5, #form6, #form7, #form8,', ).hide();

        // Show Form 8
        $('#form8').show();
    }


    function skipToForm10() {
        // Check if the switch is ON
        var switchState2 = $('#wasteTreatmentToggle').prop('checked');

        // If switch is ON, skip to Form 10
        if (switchState2) {
            showForm10();
        } else {
            // If switch is OFF, proceed to Form 9
            showForm(9);
        }
    }


        // Function to show Form 10
        function showForm10() {
        // Hide all forms and the matrix table
        $('#form1, #form2, #form3, #matrixTable, #form5, #form6, #form7, #form8, #form9').hide();

        // Show Form 10
        $('#form10').show();
    }


    function submitForm() {
    // Collect data from all forms
    var formData = {
        // Add more fields as needed
        // For example:
        startingYear: $('#startingYear').val(),
        numberOfYears: $('#numberOfYears').val(),
        batteryPercentage: $('#batteryPercentage').val(),
        // ...

        // Collect data from the matrix table (after Form 3)
        matrixTableData: collectMatrixTableData(),

        // Collect data from the table under Form 6
        form6Data: collectForm6Data(),

        // ...
    };

    // Send a POST request to the Flask backend
   

   
    $.ajax({
        type: "POST",
        url: "/http://127.0.0.1:5000/submit_data",  // Replace with your Flask route
        contentType: "application/json;charset=UTF-8",
        data: JSON.stringify(formData),
        success: function (response) {
            // Handle the response from the server, if needed
            console.log(response);

            // Redirect to the results page
            redirectToResultsPage();
        },
        error: function (error) {
            // Handle the error, if needed
            console.error(error);
        }
    });
}

function collectMatrixTableData() {
    var matrixTableData = [];
    
    // Iterate over rows in the matrix table
    $('#matrixTable tbody tr').each(function () {
        var rowData = {};
        // Get product name (first column)
        rowData.product = $(this).find('td:first-child').text();

        // Get data from input fields in the row
        $(this).find('input').each(function () {
            // Assuming your input fields have meaningful names or placeholders
            // Adjust accordingly based on your actual input fields
            var fieldName = $(this).attr('name') || $(this).attr('placeholder');
            rowData[fieldName] = $(this).val();
        });

        matrixTableData.push(rowData);
    });

    return matrixTableData;
}

function collectForm6Data() {
    var form6Data = [];
    
    // Iterate over rows in the table under Form 6
    $('#form6 tbody tr').each(function () {
        var rowData = {};
        // Get product name (first column)
        rowData.product = $(this).find('td:first-child').text();

        // Get data from input fields in the row
        rowData.weight = $(this).find('input[name="weights[]"]').val();
        rowData.lifespan = $(this).find('input[name="lifespans[]"]').val();

        form6Data.push(rowData);
    });

    return form6Data;
}



    function redirectToResultsPage() {
            // Redirect to another page (modify the URL as needed)
            window.location.href = 'Results.html';
    }

</script>

</body>
</html>
